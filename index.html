<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Karseell – احجز عرضك الآن</title>

  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1302281691617529');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1302281691617529&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->

  <style>
    body { font-family: 'Cairo', sans-serif; background:#fffaf6; color:#333; margin:0; padding:0; }
    .wrap { max-width:600px; margin:auto; padding:20px; }
    h1 { text-align:center; color:#b22222; margin-bottom:24px; }
    .offer { border:1px solid #ddd; border-radius:10px; padding:12px; margin-bottom:16px; cursor:pointer; transition:0.3s; }
    .offer:hover { box-shadow:0 0 10px #ccc; }
    .offer.selected { border-color:#b22222; background:#fdf2f1; }
    .offer img { width:100%; border-radius:10px; }
    .offer p { text-align:center; margin:8px 0; font-size:18px; color:#b22222; }
    input, button { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc; }
    button { background:#b22222; color:white; border:none; font-size:18px; cursor:pointer; }
    button:hover { background:#7d1f2a; }
    .success { display:none; text-align:center; margin-top:20px; font-size:20px; color:green; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>احجز عرضك من Karseell الآن</h1>

    <div class="offer" data-price="599" id="offer1">
      <img src="image1.jpg" alt="عرض 1">
      <p>عرض 1: الماسك + السيروم — 599ج</p>
    </div>

    <div class="offer" data-price="799" id="offer2">
      <img src="image2.jpg" alt="عرض 2">
      <p>عرض 2: المجموعة كاملة — 799ج</p>
    </div>

    <div class="offer" data-price="399" id="offer3">
      <img src="image3.jpg" alt="عرض 3">
      <p>عرض 3: الماسك فقط — 399ج</p>
    </div>

    <input type="text" id="name" placeholder="الاسم الكامل" required>
    <input type="text" id="phone" placeholder="رقم الهاتف" required>
    <input type="text" id="city" placeholder="المحافظة" required>
    <input type="text" id="address" placeholder="العنوان الكامل" required>

    <button id="submitBtn">إرسال الطلب</button>
    <div class="success" id="successMsg">✅ تم استلام طلبك بنجاح!</div>
  </div>

  <script>
    let selected = null;
    document.querySelectorAll('.offer').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('.offer').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
        selected = el;
      });
    });

    document.getElementById('submitBtn').addEventListener('click', async () => {
      if (!selected) {
        alert("اختر العرض أولًا");
        return;
      }
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const city = document.getElementById('city').value.trim();
      const address = document.getElementById('address').value.trim();
      if (!name || !phone || !city || !address) {
        alert("اكمل كل البيانات");
        return;
      }

      fbq('track', 'Purchase', {
        value: selected.dataset.price,
        currency: 'USD'
      });

      const payload = { name, phone, city, address, offer: selected.dataset.price };

      try {
        const resp = await fetch("https://script.google.com/macros/s/AKfycbyJkdJZ1xVNLEfelVd8Jo6baS5hO_snjerOfGZEtNXQynsHNiuwevMlcEJ7OZlhgBeKeQ/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) {
          console.error("Network error:", resp.status, resp.statusText);
          alert("حصل خطأ في الاتصال بالخادم. حاول مرة أخرى.");
          return;
        }

        const data = await resp.json();
        console.log("WebApp response:", data);

        if (data.status === "success") {
          document.getElementById('successMsg').style.display = "block";
        } else {
          alert("فشل الإرسال: " + (data.message || "خطأ غير معروف"));
          console.error("Server error detail:", data.detail || data);
        }
      } catch (err) {
        console.error("Submit error:", err);
        alert("حصل خطأ أثناء إرسال الطلب. افتح Console للمزيد من التفاصيل.");
      }
    });
  </script>
</body>
</html>